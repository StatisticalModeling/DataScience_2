<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Stack Overflow Developer Survey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Stack_Overflow_files/libs/clipboard/clipboard.min.js"></script>
<script src="Stack_Overflow_files/libs/quarto-html/quarto.js"></script>
<script src="Stack_Overflow_files/libs/quarto-html/popper.min.js"></script>
<script src="Stack_Overflow_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Stack_Overflow_files/libs/quarto-html/anchor.min.js"></script>
<link href="Stack_Overflow_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Stack_Overflow_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Stack_Overflow_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Stack_Overflow_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Stack_Overflow_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Stack_Overflow.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Stack Overflow Developer Survey</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Last modified on March 04, 2025 13:45:55 Eastern Standard Time</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-note no-icon callout-titled" title="Crediting the materials">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Crediting the materials
</div>
</div>
<div class="callout-body-container callout-body">
<p>The majority of the material in the first part of this document is taken from the free online course at <a href="https://supervised-ml-course.netlify.app/">https://supervised-ml-course.netlify.app/</a> written by Julia Silge.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>stack_overflow <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../Data/stack_overflow.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="essential-copying-and-pasting-from-stack-overflow" class="level2">
<h2 class="anchored" data-anchor-id="essential-copying-and-pasting-from-stack-overflow">Essential copying and pasting from stack Overflow</h2>
<p>In <a href="./Not_mtcars_AGAIN.html">Not <code>mtcars</code> Again</a>, you practiced how to build regression models to predict fuel efficiency. Our second case study uses a dataset from the Stack Overflow Developer Survey.</p>
<p>Stack Overflow is the worldâ€™s largest, most trusted online community for developers (I bet you have used it!) and every year there is a large survey of developers, to learn about developersâ€™ opinions on different technologies, work habits, and so forth.</p>
<p>In this case study, you are going to use data from the annual Developer Survey to build predictive models. First, youâ€™ll do exploratory data analysis to understand whatâ€™s in the dataset, and how some of the quantities in the survey are distributed, and then youâ€™ll practice your machine learning skills by training classification models.</p>
<p>Every year, the data for the Stack Overflow Developer Survey is made public, so this is all data that you can access and analyze yourself. Iâ€™ve already done some data cleaning and preparation, but weâ€™ll practice some of that in this chapter as well. There are a lot of predictive modeling possibilities in this dataset. Analyze the <a href="https://survey.stackoverflow.co/">data</a> yourself!</p>
<p>The specific question we are going to address is what makes a developer more likely to work remotely. Developers can work in their company offices or they can work remotely, and it turns out that there are specific characteristics of developers, such as the size of the company that they work for, how much experience they have, or where in the world they live, that affect how likely they are to be a remote developer.</p>
<p>That is what you are going to model! One of the things youâ€™ll notice right away about this dataset, however, is that the proportion of developers who are remote and those who work in an office is not balanced. This kind of class imbalance can have a significant negative impact on model performance, so we are going to have to cope with it. We will need to preprocess our data before we model it.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>stack_overflow  <span class="sc">|&gt;</span>  </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(remote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 2
  remote         n
  &lt;chr&gt;      &lt;int&gt;
1 Not remote  6273
2 Remote       718</code></pre>
</div>
</div>
<p>Letâ€™s start by exploring this new dataset, and then splitting our data into testing and training sets.</p>
</section>
<section id="choose-an-appropriate-model" class="level2">
<h2 class="anchored" data-anchor-id="choose-an-appropriate-model">Choose an appropriate model</h2>
<p>In this case study, you will predict whether a developer works remotely or not (i.e., in their company offices) from characteristics of these developers, like experience and size of the company. In this analysis, we will assume that a software developer can either work remotely, or not. What kind of model will you build? To predict group membership or discrete class labels, use <strong>classification models</strong>.</p>
<p>Anytime you are planning to implement modeling, it is always a good idea to explore your dataset. Start off this modeling analysis by checking out how many remote and non-remote developers you have to work with, where they live, and how much experience they have.</p>
<section id="instructions" class="level3">
<h3 class="anchored" data-anchor-id="instructions">Instructions</h3>
<ul>
<li>Take a look at the <code>stack_overflow</code> object.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a look at stack_overflow</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(stack_overflow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6,991
Columns: 22
$ respondent                           &lt;dbl&gt; 3, 15, 18, 19, 26, 55, 62, 71, 73â€¦
$ country                              &lt;chr&gt; "United Kingdom", "United Kingdomâ€¦
$ salary                               &lt;dbl&gt; 113750.000, 100000.000, 130000.00â€¦
$ years_coded_job                      &lt;dbl&gt; 20, 20, 20, 3, 16, 4, 1, 1, 20, 2â€¦
$ open_source                          &lt;lgl&gt; TRUE, FALSE, TRUE, FALSE, FALSE, â€¦
$ hobby                                &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, FALâ€¦
$ company_size_number                  &lt;dbl&gt; 10000, 5000, 1000, 10000, 10000, â€¦
$ remote                               &lt;chr&gt; "Not remote", "Remote", "Remote",â€¦
$ career_satisfaction                  &lt;dbl&gt; 8, 8, 9, 5, 7, 9, 5, 8, 8, 10, 7,â€¦
$ data_scientist                       &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ database_administrator               &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ desktop_applications_developer       &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ developer_with_stats_math_background &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ dev_ops                              &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, FALSE,â€¦
$ embedded_developer                   &lt;lgl&gt; FALSE, TRUE, TRUE, FALSE, FALSE, â€¦
$ graphic_designer                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ graphics_programming                 &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ machine_learning_specialist          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ mobile_developer                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ quality_assurance_engineer           &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, FALSE,â€¦
$ systems_administrator                &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ web_developer                        &lt;lgl&gt; FALSE, FALSE, TRUE, TRUE, TRUE, Tâ€¦</code></pre>
</div>
</div>
<ul>
<li>In the calls to <code>count()</code>, check out the distributions for <code>remote</code> status first, and then <code>country</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First count for `remote`</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>stack_overflow <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(remote, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 2
  remote         n
  &lt;chr&gt;      &lt;int&gt;
1 Not remote  6273
2 Remote       718</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># then count for `country`</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>stack_overflow <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(country, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 2
  country            n
  &lt;chr&gt;          &lt;int&gt;
1 United States   3486
2 United Kingdom  1270
3 Germany          950
4 India            666
5 Canada           619</code></pre>
</div>
</div>
</section>
<section id="instructions-1" class="level3">
<h3 class="anchored" data-anchor-id="instructions-1">Instructions</h3>
<p>Use the appropriate column from the data set so you can plot a boxplot with remote status on the x-axis and professional experience on the y-axis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> stack_overflow, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> remote, <span class="at">y =</span> years_coded_job)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Years of professional coding experience"</span>) <span class="sc">+</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stack_Overflow_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="training-and-testing-data" class="level2">
<h2 class="anchored" data-anchor-id="training-and-testing-data">Training and testing data</h2>
<p>Before you deal with the imbalance in the remote/not remote classes, first split your data into <em>training</em> and <em>testing</em> sets. You create subsets of your data for <em>training</em> and <em>testing</em> your model for the same reasons you did before: to reduce overfitting and obtain a more accurate estimate for how your model will perform on new data.</p>
<section id="instructions-2" class="level3">
<h3 class="anchored" data-anchor-id="instructions-2">Instructions</h3>
<p>Create a data split that divides the original data into 80%/20% sections and about evenly divides the sections between the different classes of <code>remote</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stack_overflow <span class="ot">&lt;-</span> stack_overflow <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">remote =</span> <span class="fu">factor</span>(remote, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Remote"</span>, <span class="st">"Not remote"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Create <code>stack_split</code>:</p>
<ul>
<li><p>For the first argument to <code>initial_split()</code>, use a value for <code>prop</code> of 0.8.</p></li>
<li><p>For the second argument to <code>initial_split()</code>, stratify the split by <code>remote</code> status.</p></li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create stack_select dataset</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>stack_select <span class="ot">&lt;-</span> stack_overflow <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>respondent)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing sets</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>stack_split <span class="ot">&lt;-</span> stack_select <span class="sc">|&gt;</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">initial_split</span>(<span class="at">prop =</span> <span class="fl">0.8</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">strata =</span> remote)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>stack_train <span class="ot">&lt;-</span> <span class="fu">training</span>(stack_split)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>stack_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(stack_split)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(stack_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,592
Columns: 21
$ country                              &lt;fct&gt; United Kingdom, United States, Geâ€¦
$ salary                               &lt;dbl&gt; 113750.000, 175000.000, 64516.129â€¦
$ years_coded_job                      &lt;dbl&gt; 20, 16, 4, 1, 13, 7, 17, 1, 1, 10â€¦
$ open_source                          &lt;lgl&gt; TRUE, FALSE, FALSE, FALSE, FALSE,â€¦
$ hobby                                &lt;lgl&gt; TRUE, TRUE, FALSE, TRUE, TRUE, TRâ€¦
$ company_size_number                  &lt;dbl&gt; 10000, 10000, 1000, 5000, 20, 20,â€¦
$ remote                               &lt;fct&gt; Not remote, Not remote, Not remotâ€¦
$ career_satisfaction                  &lt;dbl&gt; 8, 7, 9, 5, 7, 8, 9, 10, 5, 8, 7,â€¦
$ data_scientist                       &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ database_administrator               &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ desktop_applications_developer       &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ developer_with_stats_math_background &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ dev_ops                              &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ embedded_developer                   &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ graphic_designer                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ graphics_programming                 &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ machine_learning_specialist          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ mobile_developer                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ quality_assurance_engineer           &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ systems_administrator                &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ web_developer                        &lt;lgl&gt; FALSE, TRUE, TRUE, TRUE, TRUE, FAâ€¦</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(stack_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,399
Columns: 21
$ country                              &lt;fct&gt; United States, United States, Gerâ€¦
$ salary                               &lt;dbl&gt; 82500.000, 65000.000, 53763.441, â€¦
$ years_coded_job                      &lt;dbl&gt; 3, 1, 4, 1, 14, 1, 7, 9, 4, 20, 6â€¦
$ open_source                          &lt;lgl&gt; FALSE, FALSE, TRUE, TRUE, FALSE, â€¦
$ hobby                                &lt;lgl&gt; TRUE, TRUE, FALSE, FALSE, TRUE, Tâ€¦
$ company_size_number                  &lt;dbl&gt; 10000, 20, 5000, 10, 20, 10000, 1â€¦
$ remote                               &lt;fct&gt; Not remote, Not remote, Not remotâ€¦
$ career_satisfaction                  &lt;dbl&gt; 5, 8, 7, 9, 7, 8, 7, 6, 5, 10, 10â€¦
$ data_scientist                       &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ database_administrator               &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, TRUE,â€¦
$ desktop_applications_developer       &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ developer_with_stats_math_background &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ dev_ops                              &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, TRUE,â€¦
$ embedded_developer                   &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ graphic_designer                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ graphics_programming                 &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ machine_learning_specialist          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ mobile_developer                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ quality_assurance_engineer           &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSEâ€¦
$ systems_administrator                &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, TRUE,â€¦
$ web_developer                        &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUâ€¦</code></pre>
</div>
</div>
</section>
</section>
<section id="dealing-with-imbalanced-data" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-imbalanced-data">Dealing with imbalanced data</h2>
<p>You just took this data about which developers work remotely and which do not, and split it into testing and training sets. Before we go any further, we need to talk about the class imbalance in our dataset.</p>
<p>Itâ€™s good that weâ€™re going to talk about class imbalance because it comes up a lot in real life. In many practical, real-world situations, there are a lot more of one kind of category in a dataset than another. In our example here, there are about ten times more non-remote developers than there are remote developers. What can happen in a situation like this is that a machine learning model will always predict the majority class or otherwise exhibit poor performance on the metrics that we care about.</p>
<p>Class imbalance</p>
<ul>
<li><p>is a common problem!</p></li>
<li><p>often negatively affects the performance of your model ğŸ™€</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>stack_overflow  <span class="sc">|&gt;</span>  </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(remote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 2
  remote         n
  &lt;fct&gt;      &lt;int&gt;
1 Remote       718
2 Not remote  6273</code></pre>
</div>
</div>
<p>This is in fact what happens with our dataset here (I know because I tested it out âœ…) so we need to do something to address this imbalance. There are a variety of options available to you, which vary from quite simple to more complex, and weâ€™re going to start with a simple option.</p>
<p>In this case study, weâ€™re going to implement <strong>downsampling</strong>, also known as undersampling. With this approach, we randomly remove observations from the majority class until itâ€™s the same size as the minority class and both classes can have the same effect on the machine learning model weâ€™re training.</p>
<p>Are we really going to throw out a large percentage of our data here?! ğŸ˜± Yes! We do this because such an approach can be helpful at producing a useful model that can recognize both classes, instead of only one.</p>
<section id="downsampling" class="level3">
<h3 class="anchored" data-anchor-id="downsampling">Downsampling</h3>
<ul>
<li><p>Remove some of the majority class so it has less effect on the predictive model.</p></li>
<li><p>Randomly remove examples from the majority class until it is the same size as the minority class.</p></li>
</ul>
<p>In our case study, there are roughly ten times more non-remote developers compared to the remote developers.</p>
<p>When we implement downsampling, we remove some of the non-remote developers until the proportion is equal and the classes are balanced. This approach is simple to implement and understand, but there are other more complex approaches to class imbalance available as well.</p>
</section>
<section id="implementing-downsampling" class="level3">
<h3 class="anchored" data-anchor-id="implementing-downsampling">Implementing downsampling</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(themis)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>stack_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(remote <span class="sc">~</span> ., <span class="at">data =</span> stack_train) <span class="sc">|&gt;</span>  </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_downsample</span>(remote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Downsampling is an example of a preprocessing step for modeling. In tidymodels, you can preprocess your data using <a href="https://recipes.tidymodels.org/">recipes</a>. The recipe shown above has one preprocessing step (downsampling, that comes from an extra add-on package called <a href="https://themis.tidymodels.org/"><code>themis</code></a>), but you can implement many steps on one dataset during preprocessing. There are an enormous number of different kinds of preprocessing you can do, from creating indicator variables to implementing principal component analysis to extracting date features and more.</p>
<p>When you <code>prep()</code> a recipe, you estimate the required parameters from a data set for the preprocessing steps in that recipe (as an example, think about finding the mean and standard deviation if you are centering and scaling).</p>
<p>When you <code>bake()</code> a prepped recipe with <code>new_data = NULL</code>, you get the preprocessed data back out.</p>
<p>You donâ€™t typically need to <code>prep()</code> and <code>bake()</code> recipes when you use <code>tidymodels</code>, but they are helpful functions to have in your toolkit for confirming that recipes are doing what you expect.</p>
</section>
<section id="implementing-downsampling-1" class="level3">
<h3 class="anchored" data-anchor-id="implementing-downsampling-1">Implementing downsampling</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>stack_prep <span class="ot">&lt;-</span> <span class="fu">prep</span>(stack_recipe)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(stack_prep, <span class="at">new_data =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,148 Ã— 21
   country        salary years_coded_job open_source hobby company_size_number
   &lt;fct&gt;           &lt;dbl&gt;           &lt;dbl&gt; &lt;lgl&gt;       &lt;lgl&gt;               &lt;dbl&gt;
 1 United Kingdom 100000              20 FALSE       TRUE                 5000
 2 United States  130000              20 TRUE        TRUE                 1000
 3 United States  120000              20 TRUE        TRUE                  100
 4 United States   96283              20 TRUE        TRUE                 1000
 5 United States  100297              15 FALSE       TRUE                  100
 6 United States  146000              15 TRUE        TRUE                10000
 7 United States   50000              15 TRUE        TRUE                    1
 8 United States  160000              11 TRUE        TRUE                  500
 9 United States  103000              15 TRUE        TRUE                  500
10 United States  115000               8 TRUE        FALSE                  20
# â„¹ 1,138 more rows
# â„¹ 15 more variables: career_satisfaction &lt;dbl&gt;, data_scientist &lt;lgl&gt;,
#   database_administrator &lt;lgl&gt;, desktop_applications_developer &lt;lgl&gt;,
#   developer_with_stats_math_background &lt;lgl&gt;, dev_ops &lt;lgl&gt;,
#   embedded_developer &lt;lgl&gt;, graphic_designer &lt;lgl&gt;,
#   graphics_programming &lt;lgl&gt;, machine_learning_specialist &lt;lgl&gt;,
#   mobile_developer &lt;lgl&gt;, quality_assurance_engineer &lt;lgl&gt;, â€¦</code></pre>
</div>
</div>
</section>
<section id="when-do-you-balance-classes" class="level3">
<h3 class="anchored" data-anchor-id="when-do-you-balance-classes">When do you balance classes? ğŸ¤”</h3>
<ul>
<li><p>Training set?</p></li>
<li><p><del>Testing set?</del></p></li>
</ul>
<p>Does it make sense to try to change the class imbalance of the test set? No, it does not! ğŸ™… You want the set test to look like new data that your model will see in the future, so you donâ€™t want to mess with the class balance there; you want to see how your model will perform on imbalanced data, even if you have trained it on artificially balanced data.</p>
<p>All right, weâ€™ve talked about some serious machine learning tools here and itâ€™s time to put them into practice.</p>
</section>
</section>
<section id="preprocess-with-a-recipe" class="level2">
<h2 class="anchored" data-anchor-id="preprocess-with-a-recipe">Preprocess with a recipe</h2>
<p>There are multiple possible approaches to dealing with class imbalance. âš–ï¸ Here, you will implement downsampling using the <a href="https://themis.tidymodels.org/reference/step_downsample.html"><code>step_downsample()</code></a> function from the <a href="https://themis.tidymodels.org/"><code>themis</code></a> package.</p>
<section id="instructions-3" class="level3">
<h3 class="anchored" data-anchor-id="instructions-3">Instructions</h3>
<ul>
<li><p>Use a <code>recipe</code> to preprocess your training data.</p></li>
<li><p>Downsample this data with respect to the remote status of the developers.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(themis)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>stack_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(remote <span class="sc">~</span> ., <span class="at">data =</span> stack_train) <span class="sc">|&gt;</span>  </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_downsample</span>(remote)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>stack_recipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="downsampling-1" class="level2">
<h2 class="anchored" data-anchor-id="downsampling-1">Downsampling</h2>
<p>Once your recipe is defined, you can estimate the parameters required to actually preprocess the data, and then extract the processed data. This typically isnâ€™t necessary if you use a <code>workflow()</code> for modeling, but it can be helpful to diagnose problems or explore your preprocessing results.</p>
<section id="instructions-4" class="level3">
<h3 class="anchored" data-anchor-id="instructions-4">Instructions</h3>
<ul>
<li>First, <code>prep()</code> the recipe.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>stack_prep <span class="ot">&lt;-</span> <span class="fu">prep</span>(stack_recipe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Then, <code>bake()</code> the prepped recipe with <code>new_data = NULL</code> to see the processed training data.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>stack_down <span class="ot">&lt;-</span> <span class="fu">bake</span>(stack_prep, <span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>stack_down <span class="sc">|&gt;</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(remote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 2
  remote         n
  &lt;fct&gt;      &lt;int&gt;
1 Remote       574
2 Not remote   574</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="What `bake` does...">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What <code>bake</code> doesâ€¦
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you <code>bake()</code> the prepped recipe <code>stack_prep</code> with <code>new_data = NULL</code>, you extract the processed (i.e.&nbsp;balanced) training data.</p>
</div>
</div>
</section>
</section>
<section id="understand-downsampling" class="level2">
<h2 class="anchored" data-anchor-id="understand-downsampling">Understand downsampling</h2>
<p>Consider the original data set <code>stack_overflow</code>, the training set that you created <code>stack_train</code>, and the downsampled set you created <code>stack_down</code>. Both <code>stack_overflow</code> and <code>stack_train</code> have almost 10 times as many non-remote developers as remote developers.</p>
<p>How do the remote and non-remote developers in <code>stack_down</code> compare? <strong>There are the same number of remote and non-remote developers.</strong></p>
</section>
<section id="downsampling-in-your-workflow" class="level2">
<h2 class="anchored" data-anchor-id="downsampling-in-your-workflow">Downsampling in your workflow</h2>
<p>We are starting to add more steps into the machine learning workflow. Think about when we implemented downsampling to deal with class imbalance. Which data set did we downsample? <strong>The training data</strong>. Adjusting class imbalance helps you train a model that performs better.</p>
</section>
<section id="predicting-remote-status" class="level2">
<h2 class="anchored" data-anchor-id="predicting-remote-status">Predicting remote status</h2>
<p>Now that you have understood and implemented downsampling, or undersampling, we can finally get down to the business of building supervised machine learning models to predict which developers work remotely and which do not.</p>
<p>Unlike the first case study, when you built regression models to predict a numeric or continuous variable, in this case study you are going to build classification models, to predict the class: <strong>remote</strong> or <strong>not remote</strong>. We are going to stick with two methods to understand and implement classification models, logistic regression and a decision tree.</p>
<p>There are lots of other options, and one of the great characteristics of using tidymodels for predictive modeling is that if you want to try something else, you can extend your work to new model types within the same framework. ğŸ’</p>
<p>We are going to use model specifications from <code>parsnip</code> to set up the models. Notice here that one model is logistic regression while the other is a decision tree.</p>
<section id="logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>glm_spec <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>()  <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="decision-tree" class="level3">
<h3 class="anchored" data-anchor-id="decision-tree">Decision tree</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">|&gt;</span>         </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span>      </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">"classification"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How do we combine these model specifications with the data preprocessing we need to do from our recipe? ğŸ¤”</p>
<p>You have a few options for that, but one straightforward way is to use a <code>workflow()</code>, an object that makes it easier to carry around pieces of, well, modeling workflows! The components of a <code>workflow()</code> go together like LEGO blocks; you add a preprocessor like a <code>recipe</code> or a <code>formula</code>, and a <code>model</code>.</p>
<p>If you donâ€™t add one of those components (for example, <code>stack_wf</code> below) the <code>workflow()</code> holds an empty spot ready for, say, the <code>model</code>. You may find this a convenient way to write your modeling code when you want to fit with the same preprocessor but different model specifications.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>stack_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>()  <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(stack_recipe)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>stack_wf <span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(glm_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Preprocessor: Recipe
Model: logistic_reg()

â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1 Recipe Step

â€¢ step_downsample()

â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Logistic Regression Model Specification (classification)

Computational engine: glm </code></pre>
</div>
</div>
<p>A <code>workflow()</code> can be fit in much the same way a <code>model</code> can, and all the pieces are composable and pipeable. ğŸ‰</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>stack_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>()  <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(stack_recipe)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>stack_wf  <span class="sc">|&gt;</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(tree_spec)  <span class="sc">|&gt;</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(<span class="at">data =</span> stack_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â•â• Workflow [trained] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Preprocessor: Recipe
Model: decision_tree()

â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1 Recipe Step

â€¢ step_downsample()

â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
n= 1148 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

 1) root 1148 574 Remote (0.5000000 0.5000000)  
   2) salary&gt;=88625 477 170 Remote (0.6436059 0.3563941)  
     4) years_coded_job&gt;=7.5 338  91 Remote (0.7307692 0.2692308) *
     5) years_coded_job&lt; 7.5 139  60 Not remote (0.4316547 0.5683453)  
      10) career_satisfaction&gt;=9.5 19   5 Remote (0.7368421 0.2631579) *
      11) career_satisfaction&lt; 9.5 120  46 Not remote (0.3833333 0.6166667) *
   3) salary&lt; 88625 671 267 Not remote (0.3979136 0.6020864)  
     6) company_size_number&lt; 5.5 100  34 Remote (0.6600000 0.3400000) *
     7) company_size_number&gt;=5.5 571 201 Not remote (0.3520140 0.6479860) *</code></pre>
</div>
</div>
<p>Classification models can be evaluated using a confusion matrix. This kind of matrix or table counts which examples were classified correctly and incorrectly.</p>
</section>
</section>
<section id="train-models" class="level2">
<h2 class="anchored" data-anchor-id="train-models">Train models</h2>
<p>Finally! ğŸ˜ Itâ€™s time to train predictive models for this data set of Stack Overflow Developer Survey responses. We will specify our machine learning models with parsnip, and use workflows for convenience.</p>
<section id="instructions-5" class="level3">
<h3 class="anchored" data-anchor-id="instructions-5">Instructions</h3>
<ul>
<li>Specify a logistic regression model using <code>logistic_reg()</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Build a logistic regression model</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>glm_spec <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>glm_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic Regression Model Specification (classification)

Computational engine: glm </code></pre>
</div>
</div>
<ul>
<li>Build a <code>workflow()</code> to hold your modeling components.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Start a workflow (recipe only)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>stack_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(stack_recipe)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>stack_wf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Preprocessor: Recipe
Model: None

â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1 Recipe Step

â€¢ step_downsample()</code></pre>
</div>
</div>
<ul>
<li>Add your model specification to your <code>workflow()</code> before fitting.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Add the model and fit the workflow</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>stack_glm <span class="ot">&lt;-</span> stack_wf <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(glm_spec) <span class="sc">|&gt;</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(<span class="at">data =</span> stack_train)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the fitted model</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>stack_glm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â•â• Workflow [trained] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Preprocessor: Recipe
Model: logistic_reg()

â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1 Recipe Step

â€¢ step_downsample()

â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Call:  stats::glm(formula = ..y ~ ., family = stats::binomial, data = data)

Coefficients:
                             (Intercept)  
                               2.344e+00  
                          countryGermany  
                               4.407e-01  
                            countryIndia  
                              -8.369e-01  
                   countryUnited Kingdom  
                               2.972e-01  
                    countryUnited States  
                              -3.928e-01  
                                  salary  
                              -4.657e-06  
                         years_coded_job  
                              -7.857e-02  
                         open_sourceTRUE  
                              -4.979e-01  
                               hobbyTRUE  
                              -7.738e-02  
                     company_size_number  
                               5.197e-05  
                     career_satisfaction  
                              -9.131e-02  
                      data_scientistTRUE  
                              -4.157e-01  
              database_administratorTRUE  
                              -2.314e-01  
      desktop_applications_developerTRUE  
                               3.123e-01  
developer_with_stats_math_backgroundTRUE  
                               2.206e-02  
                             dev_opsTRUE  
                               2.462e-01  
                  embedded_developerTRUE  
                               4.575e-02  
                    graphic_designerTRUE  
                              -5.837e-01  
                graphics_programmingTRUE  
                              -3.108e-01  
         machine_learning_specialistTRUE  
                               4.030e-01  
                    mobile_developerTRUE  
                              -1.932e-01  
          quality_assurance_engineerTRUE  
                               2.525e-01  
               systems_administratorTRUE  
                              -1.001e-01  

...
and 6 more lines.</code></pre>
</div>
</div>
</section>
<section id="instructions-6" class="level3">
<h3 class="anchored" data-anchor-id="instructions-6">Instructions</h3>
<p>Build a decision tree model with downsampling.</p>
<ul>
<li>Specify a decision tree regression model using <code>decision_tree()</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Build a decision tree model</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>()  <span class="sc">|&gt;</span>          </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"rpart"</span>)  <span class="sc">|&gt;</span>       </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">"classification"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Add your recipe <code>stack_recipe</code> to your <code>workflow()</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Start a workflow (recipe only)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>stack_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>()  <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(stack_recipe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Fit your workflow, after you have added your model to it.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Add the model and fit the workflow</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>stack_tree <span class="ot">&lt;-</span> stack_wf  <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(tree_spec)  <span class="sc">|&gt;</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(<span class="at">data =</span> stack_train)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the fitted model</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>stack_tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â•â• Workflow [trained] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Preprocessor: Recipe
Model: decision_tree()

â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1 Recipe Step

â€¢ step_downsample()

â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
n= 1148 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

 1) root 1148 574 Remote (0.5000000 0.5000000)  
   2) salary&gt;=88625 477 170 Remote (0.6436059 0.3563941)  
     4) years_coded_job&gt;=7.5 338  91 Remote (0.7307692 0.2692308) *
     5) years_coded_job&lt; 7.5 139  60 Not remote (0.4316547 0.5683453)  
      10) career_satisfaction&gt;=9.5 19   5 Remote (0.7368421 0.2631579) *
      11) career_satisfaction&lt; 9.5 120  46 Not remote (0.3833333 0.6166667) *
   3) salary&lt; 88625 671 267 Not remote (0.3979136 0.6020864)  
     6) company_size_number&lt; 5.5 100  34 Remote (0.6600000 0.3400000) *
     7) company_size_number&gt;=5.5 571 201 Not remote (0.3520140 0.6479860) *</code></pre>
</div>
</div>
<ul>
<li>Graph the tree using <code>rpart.plot()</code> from the <code>rpart.plot</code> package.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>stack_tree <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  rpart.plot<span class="sc">::</span><span class="fu">rpart.plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-tree" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Stack_Overflow_files/figure-html/fig-tree-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Tree model for predicting where a person works</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Node explanation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Node explanation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Each node in <a href="#fig-tree">Figure&nbsp;1</a> shows:</p>
<ul>
<li><p>the predicted class (Remote or Not remote),</p></li>
<li><p>the predicted probability of <code>Not remote</code>,</p></li>
<li><p>the percentage of observations in the node.</p></li>
</ul>
</div>
</div>
<ul>
<li>Display the rules used to create <a href="#fig-tree">Figure&nbsp;1</a>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>stack_tree <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  rpart.plot<span class="sc">::</span><span class="fu">rpart.rules</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ..y                                                                                                        
 0.26 when salary &gt;= 88625 &amp; years_coded_job &lt;  7.5                              &amp; career_satisfaction &gt;= 9.5
 0.27 when salary &gt;= 88625 &amp; years_coded_job &gt;= 7.5                                                          
 0.34 when salary &lt;  88625                          &amp; company_size_number &lt;  5.5                             
 0.62 when salary &gt;= 88625 &amp; years_coded_job &lt;  7.5                              &amp; career_satisfaction &lt;  9.5
 0.65 when salary &lt;  88625                          &amp; company_size_number &gt;= 5.5                             </code></pre>
</div>
</div>
</section>
</section>
<section id="confusion-matrix" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix">Confusion matrix</h2>
<p>A confusion matrix describes how well a classification model (like the ones you just trained!) performs. A confusion matrix tabulates how many examples in each class were correctly classified by a model. In your case, it will show you how many remote developers were classified as remote and how many non-remote developers were classified as non-remote; the confusion matrix also shows you how many were classified into the <strong>wrong</strong> categories.</p>
<p>Here you will use the <a href="https://yardstick.tidymodels.org/reference/conf_mat.html"><code>conf_mat()</code></a> function from <code>yardstick</code> to evaluate the performance of the two models you trained, <code>stack_glm</code> and <code>stack_tree</code>. The models available in your environment were trained on the training data.</p>
<section id="instructions-7" class="level3">
<h3 class="anchored" data-anchor-id="instructions-7">Instructions</h3>
<p>Print the confusion matrix for the <code>stack_glm</code> model on the <code>stack_test</code> data. If we wanted to compare more than two modeling options, we should definitely create some resampled data sets like we did in the first case study. This case study is already getting long, so letâ€™s stick with the testing data.</p>
<p>Note that the first argument to <code>conf_mat()</code> is <code>truth</code> and the second is <code>estimate</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> stack_test <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">predict</span>(stack_glm, stack_test) <span class="sc">|&gt;</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rename</span>(<span class="at">.pred_glm =</span> .pred_class))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix for logistic regression model</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth =</span> remote, <span class="at">estimate =</span> .pred_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Truth
Prediction   Remote Not remote
  Remote         81        419
  Not remote     63        836</code></pre>
</div>
</div>
</section>
<section id="instructions-8" class="level3">
<h3 class="anchored" data-anchor-id="instructions-8">Instructions</h3>
<p>Print the confusion matrix for the <code>stack_tree</code> model on the <code>stack_test</code> data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> stack_test  <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">predict</span>(stack_tree, stack_test)  <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rename</span>(<span class="at">.pred_tree =</span> .pred_class))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix for decision tree model</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>results  <span class="sc">|&gt;</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth =</span> remote, <span class="at">estimate =</span> .pred_tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Truth
Prediction   Remote Not remote
  Remote         78        289
  Not remote     66        966</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>results  <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth =</span> remote, <span class="at">estimate =</span> .pred_tree) <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 Ã— 3
   .metric              .estimator .estimate
   &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
 1 accuracy             binary         0.746
 2 kap                  binary         0.185
 3 sens                 binary         0.542
 4 spec                 binary         0.770
 5 ppv                  binary         0.213
 6 npv                  binary         0.936
 7 mcc                  binary         0.215
 8 j_index              binary         0.311
 9 bal_accuracy         binary         0.656
10 detection_prevalence binary         0.262
11 precision            binary         0.213
12 recall               binary         0.542
13 f_meas               binary         0.305</code></pre>
</div>
</div>
</section>
</section>
<section id="classification-model-metrics" class="level2">
<h2 class="anchored" data-anchor-id="classification-model-metrics">Classification model metrics</h2>
<p>The <code>conf_mat()</code> function is helpful but often you also want to store specific performance estimates for later, perhaps in a dataframe-friendly form. The yardstick package is built to handle such needs. For this kind of classification model, you might look at the <a href="https://yardstick.tidymodels.org/reference/ppv.html">positive or negative predictive value</a> or perhaps overall <a href="https://yardstick.tidymodels.org/reference/accuracy.html">accuracy</a>.</p>
<p>The models available in your environment, <code>stack_glm</code> and <code>stack_tree</code> were trained on the <strong>training</strong> data.</p>
<section id="instructions-9" class="level3">
<h3 class="anchored" data-anchor-id="instructions-9">Instructions</h3>
<ul>
<li>Predict values for logistic regression (<code>stack_glm</code>) and decision tree (<code>stack_tree)</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> stack_test <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">predict</span>(stack_glm, stack_test) <span class="sc">|&gt;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rename</span>(<span class="at">.pred_glm =</span> .pred_class)) <span class="sc">|&gt;</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">predict</span>(stack_tree, stack_test) <span class="sc">|&gt;</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rename</span>(<span class="at">.pred_tree =</span> .pred_class))</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(results <span class="sc">|&gt;</span> <span class="fu">select</span>(.pred_glm, .pred_tree)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">.pred_glm</th>
<th style="text-align: left;">.pred_tree</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Not remote</td>
<td style="text-align: left;">Not remote</td>
</tr>
<tr class="even">
<td style="text-align: left;">Not remote</td>
<td style="text-align: left;">Not remote</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Not remote</td>
<td style="text-align: left;">Not remote</td>
</tr>
<tr class="even">
<td style="text-align: left;">Not remote</td>
<td style="text-align: left;">Not remote</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Remote</td>
<td style="text-align: left;">Remote</td>
</tr>
<tr class="even">
<td style="text-align: left;">Not remote</td>
<td style="text-align: left;">Not remote</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Calculate both accuracy and positive predictive value for these two models.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate accuracy</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(results, <span class="at">truth =</span> remote, <span class="at">estimate =</span> .pred_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.655</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(results, <span class="at">truth =</span> remote, <span class="at">estimate =</span> .pred_tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.746</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate positive predict value</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ppv</span>(results, <span class="at">truth =</span> remote, <span class="at">estimate =</span> .pred_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 ppv     binary         0.162</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ppv</span>(results, <span class="at">truth =</span> remote, <span class="at">estimate =</span> .pred_tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 ppv     binary         0.213</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>